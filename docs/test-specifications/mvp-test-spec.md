# 将棋対戦アプリ MVPテスト仕様書

## 1. テスト概要

### 1.1 テスト目的
将棋対戦アプリのMVP機能が要件定義書通りに動作することを確認する。

### 1.2 テスト範囲
- 将棋盤と駒の表示
- 駒の移動と将棋ルール
- コンピューター対戦機能
- 対局管理機能
- UI/UXの基本動作

### 1.3 テスト種別
- 単体テスト（Unit Test）
- 統合テスト（Integration Test）
- E2Eテスト（End-to-End Test）

## 2. 単体テスト仕様

### 2.1 ドメイン層テスト

#### 2.1.1 駒クラステスト
**テスト対象：** `src/domain/models/Piece.ts`

| テストID | テスト項目 | 期待結果 |
|---------|-----------|---------|
| UT-D-001 | 歩の移動可能範囲計算 | 前方1マスのみ返却される |
| UT-D-002 | 歩の成り判定 | 敵陣3段目以内で成り可能 |
| UT-D-003 | 香車の移動可能範囲計算 | 前方直線上の全マスが返却される |
| UT-D-004 | 桂馬の移動可能範囲計算 | 前方の2つの桂馬飛びが返却される |
| UT-D-005 | 銀の移動可能範囲計算 | 斜め4方向と前方1マスが返却される |
| UT-D-006 | 金の移動可能範囲計算 | 斜め後方以外の6マスが返却される |
| UT-D-007 | 角の移動可能範囲計算 | 斜め4方向の直線上全マスが返却される |
| UT-D-008 | 飛車の移動可能範囲計算 | 縦横4方向の直線上全マスが返却される |
| UT-D-009 | 玉の移動可能範囲計算 | 周囲8マスが返却される |
| UT-D-010 | 成り駒の動き | 成った後の正しい動きが返却される |

#### 2.1.2 盤面クラステスト
**テスト対象：** `src/domain/models/Board.ts`

| テストID | テスト項目 | 期待結果 |
|---------|-----------|---------|
| UT-D-011 | 初期配置の生成 | 正しい初期配置が生成される |
| UT-D-012 | 駒の移動処理 | 指定位置に駒が移動される |
| UT-D-013 | 駒を取る処理 | 相手の駒が持ち駒になる |
| UT-D-014 | 持ち駒を打つ処理 | 持ち駒が盤面に配置される |
| UT-D-015 | 二歩判定 | 同じ列に歩がある場合エラー |
| UT-D-016 | 行き所のない駒判定 | 移動不可能な位置への配置を禁止 |

#### 2.1.3 ゲームルールテスト
**テスト対象：** `src/domain/services/GameRules.ts`

| テストID | テスト項目 | 期待結果 |
|---------|-----------|---------|
| UT-D-017 | 王手判定 | 王が攻撃されている場合true |
| UT-D-018 | 詰み判定 | 王手が解除できない場合true |
| UT-D-019 | 千日手判定 | 同一局面4回でtrue |
| UT-D-020 | 合法手生成 | 全ての合法手が生成される |

### 2.2 ユースケース層テスト

#### 2.2.1 対局ユースケーステスト
**テスト対象：** `src/usecases/game/GameUseCase.ts`

| テストID | テスト項目 | 期待結果 |
|---------|-----------|---------|
| UT-U-001 | 新規対局開始 | 初期状態の対局が生成される |
| UT-U-002 | 駒移動の実行 | 正しく駒が移動し、手番が変わる |
| UT-U-003 | 不正な移動の拒否 | エラーが返され、状態が変わらない |
| UT-U-004 | AI思考実行 | 合法手が返される |
| UT-U-005 | 投了処理 | ゲームが終了状態になる |

### 2.3 プレゼンテーション層テスト

#### 2.3.1 コンポーネントテスト
**テスト対象：** `src/components/features/Board.tsx`

| テストID | テスト項目 | 期待結果 |
|---------|-----------|---------|
| UT-P-001 | 盤面の描画 | 9×9のマスが表示される |
| UT-P-002 | 駒の描画 | 各駒が正しい位置に表示される |
| UT-P-003 | 駒のクリック | 選択状態になり、移動可能マスがハイライトされる |
| UT-P-004 | 移動先クリック | 駒が移動する |
| UT-P-005 | 持ち駒の表示 | 取った駒が持ち駒エリアに表示される |

## 3. 統合テスト仕様

### 3.1 ゲームフローテスト

| テストID | テスト項目 | テスト手順 | 期待結果 |
|---------|-----------|-----------|---------|
| IT-001 | 通常の対局フロー | 1. 新規対局開始<br>2. 駒を数手動かす<br>3. AIの応答確認 | 正常に対局が進行する |
| IT-002 | 成り処理フロー | 1. 歩を敵陣まで進める<br>2. 成り選択 | 歩が「と」に変わる |
| IT-003 | 王手処理フロー | 1. 王手をかける<br>2. AIの応答確認 | AIが王手を解除する手を指す |
| IT-004 | 詰みフロー | 1. 詰みの状態を作る<br>2. 勝敗判定確認 | 対局終了し、勝者が表示される |

## 4. E2Eテスト仕様

### 4.1 基本シナリオテスト

| テストID | テストシナリオ | テスト手順 | 期待結果 |
|---------|-------------|-----------|---------|
| E2E-001 | 完全な一局プレイ | 1. アプリ起動<br>2. 新規対局開始<br>3. 複数手を指す<br>4. 投了する | 正常に対局が終了する |
| E2E-002 | 駒の成りシナリオ | 1. 歩を敵陣に進める<br>2. 成りダイアログで「成る」選択<br>3. 成った駒で移動 | 成り駒として動作する |
| E2E-003 | 持ち駒使用シナリオ | 1. 相手の駒を取る<br>2. 持ち駒をクリック<br>3. 配置可能な場所に打つ | 持ち駒が正しく使用できる |
| E2E-004 | 異常系シナリオ | 1. 不正な移動を試みる<br>2. 二歩を試みる<br>3. 相手の手番に移動を試みる | 全てエラーとなり、移動できない |

### 4.2 パフォーマンステスト

| テストID | テスト項目 | 測定項目 | 合格基準 |
|---------|-----------|---------|---------|
| PT-001 | 初期表示速度 | ページロード時間 | 3秒以内 |
| PT-002 | 駒移動レスポンス | クリックから移動完了まで | 100ms以内 |
| PT-003 | AI思考時間 | プレイヤー着手からAI着手まで | 1秒以内 |

## 5. テスト環境

### 5.1 テスト環境
- OS: Windows 11, macOS Ventura, Ubuntu 22.04
- ブラウザ: Chrome 120+, Firefox 120+, Safari 17+, Edge 120+
- 画面解像度: 1920×1080, 1366×768, 1024×768

### 5.2 テストツール
- 単体テスト: Jest + React Testing Library
- E2Eテスト: Playwright
- パフォーマンス測定: Chrome DevTools

## 6. テスト実施計画

### 6.1 テスト実施順序
1. 単体テスト（開発と並行して実施）
2. 統合テスト（機能実装完了後）
3. E2Eテスト（統合テスト完了後）
4. パフォーマンステスト（全機能実装後）

### 6.2 テスト完了基準
- 全テストケースの実施完了
- 重大なバグがゼロ
- 単体テストカバレッジ80%以上
- パフォーマンス基準を満たす

## 7. 不具合管理

### 7.1 不具合の優先度
- **Critical**: ゲームが進行不能になる
- **High**: 主要機能が正しく動作しない
- **Medium**: 副次的な機能の不具合
- **Low**: UIの軽微な不具合

### 7.2 修正基準
- Critical/High: MVP リリース前に必ず修正
- Medium: 可能な限りMVPで修正
- Low: 次フェーズで対応検討