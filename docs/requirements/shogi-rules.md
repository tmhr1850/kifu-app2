# 将棋ルール詳細仕様書

## 1. 将棋の基本

### 1.1 ゲームの目的

相手の玉将（王将）を詰ます（逃げられない状態にする）ことが目的。

### 1.2 基本構成

- **盤面**: 9×9 の 81 マス
- **駒**: 各プレイヤー 20 枚（8 種類）
- **プレイヤー**: 先手（下側）と後手（上側）の 2 人

### 1.3 座標系

- 横方向：右から 1〜9 の数字
- 縦方向：上から一〜九の漢数字
- 表記例：5 五（中央）、7 六（先手の歩の初期位置）

## 2. 駒の種類と初期配置

### 2.1 初期配置図

```
後手の持ち駒：なし
  ９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+
|香|桂|銀|金|玉|金|銀|桂|香|一
+---------------------------+
|  |飛|  |  |  |  |  |角|  |二
+---------------------------+
|歩|歩|歩|歩|歩|歩|歩|歩|歩|三
+---------------------------+
|  |  |  |  |  |  |  |  |  |四
+---------------------------+
|  |  |  |  |  |  |  |  |  |五
+---------------------------+
|  |  |  |  |  |  |  |  |  |六
+---------------------------+
|歩|歩|歩|歩|歩|歩|歩|歩|歩|七
+---------------------------+
|  |角|  |  |  |  |  |飛|  |八
+---------------------------+
|香|桂|銀|金|王|金|銀|桂|香|九
+---------------------------+
先手の持ち駒：なし
```

### 2.2 駒の種類と枚数

| 駒名      | 略称  | 枚数（各プレイヤー） |
| --------- | ----- | -------------------- |
| 玉将/王将 | 玉/王 | 1                    |
| 飛車      | 飛    | 1                    |
| 角行      | 角    | 1                    |
| 金将      | 金    | 2                    |
| 銀将      | 銀    | 2                    |
| 桂馬      | 桂    | 2                    |
| 香車      | 香    | 2                    |
| 歩兵      | 歩    | 9                    |

## 3. 駒の動き

### 3.1 各駒の移動ルール

#### 3.1.1 玉将（玉）・王将（王）

- **移動**: 全方向に 1 マス
- **特記**: 相手に取られると負け

```
□□□
□玉□  ○：移動可能
□□□
```

#### 3.1.2 飛車（飛）

- **移動**: 縦横に何マスでも移動可能（他の駒を飛び越えられない）

```
  ○
  ○
○○飛○○
  ○
  ○
```

#### 3.1.3 角行（角）

- **移動**: 斜めに何マスでも移動可能（他の駒を飛び越えられない）

```
○   ○
 ○ ○
  角
 ○ ○
○   ○
```

#### 3.1.4 金将（金）

- **移動**: 前・横・斜め前・真後ろに 1 マス（斜め後ろには移動不可）

```
○○○
○金○
×○×
```

#### 3.1.5 銀将（銀）

- **移動**: 前・斜めに 1 マス（横・真後ろには移動不可）

```
○○○
×銀×
○×○
```

#### 3.1.6 桂馬（桂）

- **移動**: 前方へ 2 マス進んで左右に 1 マス（他の駒を飛び越えられる）
- **特記**: 後ろや横には移動できない

```
○ ○
× ×
 桂
```

#### 3.1.7 香車（香）

- **移動**: 前方に何マスでも移動可能（他の駒を飛び越えられない）
- **特記**: 後ろや横には移動できない

```
 ○
 ○
 ○
 香
```

#### 3.1.8 歩兵（歩）

- **移動**: 前に 1 マスのみ
- **特記**: 後ろや横には移動できない

```
○
歩
```

## 4. 成り駒

### 4.1 成りのルール

- **成れる条件**: 敵陣（相手側の 3 段目以内）に入る、または敵陣から出る時
- **成りの選択**: 成ることは任意（ただし、次項の強制成りを除く）
- **強制成り**: 成らないと次に移動できない場合は必ず成る
  - 歩・香が最奥段に到達した場合
  - 桂が最奥段または 2 段目に到達した場合

### 4.2 成り駒の動き

#### 4.2.1 竜王（竜）- 成り飛車

- **移動**: 飛車の動き + 斜め 1 マス

```
○ ○ ○
 ○○○
○○竜○○
 ○○○
○ ○ ○
```

#### 4.2.2 竜馬（馬）- 成り角

- **移動**: 角の動き + 縦横 1 マス

```
○ ○ ○
○○○○○
 ○馬○
○○○○○
○ ○ ○
```

#### 4.2.3 成銀・成桂・成香・と金（と）

- **移動**: すべて金と同じ動き

```
○○○
○成○
×○×
```

### 4.3 成れない駒

- 玉将（王将）
- 金将
- 既に成っている駒

## 5. 特殊ルール

### 5.1 駒を取る

- 相手の駒がいるマスに移動することで、その駒を取れる
- 取った駒は「持ち駒」となり、自分の手番で使用可能

### 5.2 持ち駒を打つ

- **基本ルール**: 空いているマスに持ち駒を打てる
- **禁止事項**:
  - **二歩**: 同じ縦列に歩を 2 枚置くことはできない（と金は除く）
  - **打ち歩詰め**: 歩を打って即詰みにすることはできない
  - **行き所のない駒**: 次に移動できない場所には打てない
    - 歩・香：最奥段
    - 桂：最奥段と 2 段目

### 5.3 王手と詰み

- **王手**: 次の手で相手の玉を取れる状態
- **詰み**: 王手がかかっており、どのように対処しても王手を解除できない状態
- **王手の解除方法**:
  1. 玉を逃がす
  2. 王手をかけている駒を取る
  3. 王手をかけている駒と玉の間に駒を移動させる（合駒）

### 5.4 千日手

- 同一局面が 4 回現れた場合、引き分けとなる
- ただし、連続王手の千日手は王手をかけている側の負け

### 5.5 持将棋

- 両者の玉が敵陣に入り、詰みが見込めない場合
- 点数計算により勝敗を決定（飛車・角は 5 点、その他は 1 点）

## 6. ゲームの終了条件

### 6.1 勝敗の決定

1. **詰み**: 相手を詰ました方が勝ち
2. **投了**: 投了した方が負け
3. **時間切れ**: 持ち時間を使い切った方が負け（MVP では未実装）
4. **反則**: 反則を行った方が負け

### 6.2 引き分け

1. **千日手**: 同一局面 4 回
2. **持将棋**: 両者の合意による

## 7. プログラム実装上の注意点

### 7.1 座標系の変換

- UI 表示: 人間が読みやすい形式（7 六など）
- 内部処理: 配列インデックス（0-8 の数値）

### 7.2 先手後手の処理

- 駒の向き: 先手は上向き、後手は下向き
- 移動方向: 後手の「前」は先手から見ると「後ろ」

### 7.3 成り判定の実装

- 移動元と移動先の両方をチェック
- プレイヤーに成りの選択肢を提示（強制成りを除く）

### 7.4 合法手生成

1. 基本的な駒の動きを生成
2. 自玉が王手になる手を除外
3. 二歩などの禁じ手を除外
4. 打ち歩詰めをチェック
